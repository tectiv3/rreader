import{x as Te,z as Me,o as J,b as Y,w as Ce,n as Se,g as i,m as Q,N as ee,h as n,j as te,k as v,l as E,t as _,F as Le,i as De,U as Ee,a as f,E as A,c as u}from"./app-DQQxaQue.js";import{u as Re}from"./useArticleStore-BffKVLAw.js";import{u as ze}from"./useToast-B0hvXMW-.js";import{_ as Ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useSidebarStore-0NBIamx_.js";const Ie={class:"sticky top-0 z-30 border-b border-neutral-200 dark:border-neutral-800 bg-white/95 dark:bg-neutral-900/95 backdrop-blur supports-[backdrop-filter]:bg-white/80 dark:supports-[backdrop-filter]:bg-neutral-900/80 pt-safe"},He={class:"flex h-11 items-center justify-between px-4"},Ne={class:"flex items-center gap-1 shrink-0"},je=["aria-label"],Be=["fill"],Xe={key:0,class:"absolute right-0 top-full mt-1 w-48 rounded-lg border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 shadow-lg py-1 z-50"},Ve={key:0,class:"flex items-center justify-center py-20"},$e={key:1,class:"overflow-x-hidden"},Oe={class:"mb-6"},Ye={class:"text-2xl font-bold leading-tight text-neutral-900 dark:text-neutral-100"},Pe=["href"],qe={class:"mt-3 flex flex-wrap items-center gap-x-3 gap-y-1 text-sm text-neutral-500 dark:text-neutral-400"},Ue=["src"],Fe={key:1},We=["src","alt"],Ge=["innerHTML"],Ze={key:1,class:"py-12 text-center"},Ke={class:"mt-8 flex items-center justify-between border-t border-neutral-200 dark:border-neutral-800 pt-4"},Je={key:1},Qe={key:3},et=150,tt=15,re=100,rt=.5,nt=.45,at={__name:"ArticleDetailView",setup(ot){const w=Re(),T=Te(),M=Me(),{success:I}=ze(),r=f(null),H=f(!0),g=f(!1),b=f(!1),N=f(null),y=f(null),C=f(!1),m=f(!1),h=f(null);function j(){const t=window.innerWidth<1024;m.value!==t&&(m.value=t)}J(()=>{j(),window.addEventListener("resize",j)}),Y(()=>{window.removeEventListener("resize",j)});function ne(t){window.__swReady?.then(e=>{e&&e.postMessage({type:"save-reading-state",state:{url:t}})})}function B(){window.__swReady?.then(t=>{t&&t.postMessage({type:"clear-reading-state"})})}Y(()=>B());async function P(t){H.value=!0,r.value=null,m.value&&h.value?h.value.scrollTop=0:window.scrollTo(0,0);const e=`/articles/${t}`;ne(e);try{const a=await w.fetchContent(Number(t));r.value=a,g.value=a.is_read_later||!1,Ee(a.title),w.markRead(Number(t)),w.prefetchAdjacent(Number(t))}catch{B(),T.replace({name:"articles.index"})}finally{H.value=!1}}P(M.params.id),Ce(()=>M.params.id,async t=>{t&&M.name==="articles.show"&&(C.value=!1,await P(t),await Se(),W())});const k=A(()=>r.value?w.adjacentIds(r.value.id):{prev:null,next:null});function S(t){if(C.value)return;const e=t==="next"?k.value.next:k.value.prev;e&&(C.value=!0,sessionStorage.setItem("article-swipe-direction",t),T.replace({name:"articles.show",params:{id:e}}))}const ae=A(()=>r.value?.image_url?!(r.value.content||r.value.summary||"").includes(r.value.image_url):!1),oe=A(()=>r.value?new Date(r.value.published_at).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),se=A(()=>r.value?new Date(r.value.published_at).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):"");function X(){B();const t=M.fullPath;T.back(),setTimeout(()=>{M.fullPath===t&&T.push({name:"articles.index"})},100)}function le(){r.value&&(w.toggleReadLater(r.value.id),g.value=!g.value,I(g.value?"Article saved":"Removed from Read Later"))}function ie(){r.value&&(b.value=!1,w.markUnread(r.value.id),I("Marked as unread"))}function q(){if(r.value?.url){b.value=!1;try{const t=new URL(r.value.url);(t.protocol==="http:"||t.protocol==="https:")&&window.open(t.href,"_blank","noopener,noreferrer")}catch{}}}function ue(){r.value&&(navigator.share?navigator.share({title:r.value.title,url:r.value.url}).catch(()=>{}):r.value.url&&navigator.clipboard.writeText(r.value.url).then(()=>{I("Link copied to clipboard")}).catch(()=>{}))}function ce(){b.value=!b.value}function U(t){N.value&&!N.value.contains(t.target)&&(b.value=!1)}function F(t){t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"||t.target.isContentEditable||(t.key==="ArrowRight"||t.key==="j"?S("next"):t.key==="ArrowLeft"||t.key==="k"?S("prev"):t.key==="Escape"&&X())}function W(){const t=sessionStorage.getItem("article-swipe-direction");if(t&&y.value){sessionStorage.removeItem("article-swipe-direction");const e=y.value,a=t==="next"?"40%":"-40%";e.style.transition="none",e.style.transform=`translateX(${a})`,e.offsetHeight,e.style.transition="transform 160ms ease-out",e.style.transform="translateX(0)",e.addEventListener("transitionend",()=>{e.style.transition="",e.style.transform=""},{once:!0})}}J(()=>{document.addEventListener("click",U),document.addEventListener("keydown",F),W()}),Y(()=>{document.removeEventListener("click",U),document.removeEventListener("keydown",F),l="idle",K()});const L=f(null),D=f(null);let V=0,R=0,$=0,l="idle",G=!1,x=0;function de(){return window.visualViewport?window.visualViewport.scale>1.05:!1}function ve(t){if(l==="animating"||!m.value||C.value||de())return;V=t.touches[0].clientX,R=t.touches[0].clientY,$=Date.now(),x=0;const e=h.value;G=e?e.scrollTop<=0:!1,l="tracking"}function fe(t){if(l==="idle"||l==="animating"||!m.value)return;const e=t.touches[0].clientX-V,a=t.touches[0].clientY-R,s=Math.abs(e),o=Math.abs(a);if(l==="tracking"){if(Math.sqrt(s*s+o*o)<tt)return;if(o>s&&a>0&&G)l="dismissing",t.preventDefault();else if(s>o*1.2)l="horizontal",t.preventDefault();else{l="idle";return}}if(l==="dismissing"){t.preventDefault();const c=Math.max(0,t.touches[0].clientY-R);ge(c)}l==="horizontal"&&(t.preventDefault(),me(e))}function pe(t){const e=l,a=t.changedTouches[0].clientX-V,s=t.changedTouches[0].clientY-R;if(e==="horizontal"){const o=Date.now()-$,c=Math.abs(a)/Math.max(o,1);if((Math.abs(x)>re||c>rt)&&!C.value){const p=x<0?"next":"prev";if(p==="next"?k.value.next:k.value.prev){he(p);return}}ke();return}if(e==="dismissing"){const o=Date.now()-$,c=s/Math.max(o,1),d=window.innerHeight*.3,p=Math.max(0,s)*.6;p>et||p>d||c>1.5?ye():xe();return}l="idle"}function me(t){const e=y.value,a=D.value;if(!e)return;const o=(t<0?"next":"prev")==="next"?k.value.next:k.value.prev;if(x=t*(o?nt:.15),e.style.transition="none",e.style.transform=`translateX(${x}px)`,e.style.willChange="transform",a){const d=Math.min(Math.abs(x)/re,1),p=t<0;a.style.transition="none",a.style.opacity=String(o?d*.9:d*.3),a.className="swipe-indicator "+(p?"swipe-indicator-right":"swipe-indicator-left");const z=a.querySelector(".swipe-chevron");if(z){const be=.6+.4*d,_e=p?" scaleX(-1)":"";z.style.transform=`scale(${be})${_e}`,z.style.opacity=String(o?1:.4)}const O=a.querySelector(".swipe-label");O&&(O.style.opacity=String(d>.6?(d-.6)/.4:0),O.textContent=o?p?"Next":"Previous":"")}}function he(t){l="animating";const e=y.value,a=D.value;if(!e)return;const s=t==="next"?-window.innerWidth:window.innerWidth;e.style.transition="transform 200ms ease-in",e.style.transform=`translateX(${s}px)`,a&&(a.style.transition="opacity 200ms ease-in",a.style.opacity="0");let o=!1;const c=()=>{o||(o=!0,clearTimeout(d),Z(),S(t))},d=setTimeout(c,300);e.addEventListener("transitionend",c,{once:!0})}function ke(){l="animating";const t=y.value,e=D.value;if(!t){l="idle";return}t.style.transition="transform 250ms cubic-bezier(0.2, 0.9, 0.3, 1.0)",t.style.transform="translateX(0)",e&&(e.style.transition="opacity 250ms ease-out",e.style.opacity="0");let a=!1;const s=()=>{a||(a=!0,clearTimeout(o),Z())},o=setTimeout(s,350);t.addEventListener("transitionend",s,{once:!0})}function Z(){l="idle",x=0;const t=y.value,e=D.value;t&&(t.style.transition="",t.style.transform="",t.style.willChange=""),e&&(e.style.transition="",e.style.opacity="0")}function ge(t){const e=h.value,a=L.value;if(!e)return;const s=t*.6,o=window.innerHeight*.5,c=Math.min(s/o,1),d=1-.08*c;e.style.transition="none",e.style.transform=`translateY(${s}px) scale(${d})`,e.style.transformOrigin="top center",e.style.borderRadius=`${12*c}px`,a&&(a.style.transition="none",a.style.opacity=String(.5*c))}function ye(){l="animating";const t=h.value,e=L.value;if(!t)return;t.style.transition="transform 250ms ease-in, border-radius 250ms ease-in",t.style.transform="translateY(100vh) scale(0.9)",t.style.borderRadius="12px",e&&(e.style.transition="opacity 250ms ease-in",e.style.opacity="0");let a=!1;const s=()=>{a||(a=!0,clearTimeout(o),l="idle",X())},o=setTimeout(s,400);t.addEventListener("transitionend",s,{once:!0})}function xe(){l="animating";const t=h.value,e=L.value;if(!t)return;t.style.transition="transform 300ms cubic-bezier(0.2, 0.9, 0.3, 1.0), border-radius 300ms ease-out",t.style.transform="translateY(0) scale(1)",t.style.borderRadius="0px",e&&(e.style.transition="opacity 300ms ease-out",e.style.opacity="0");let a=!1;const s=()=>{a||(a=!0,clearTimeout(o),l="idle",K())},o=setTimeout(s,450);t.addEventListener("transitionend",s,{once:!0})}function K(){const t=h.value,e=L.value;t&&(t.style.transition="",t.style.transform="",t.style.transformOrigin="",t.style.borderRadius=""),e&&(e.style.transition="",e.style.opacity="0")}function we(t){T.push({name:"articles.index",query:{feed_id:t}})}return(t,e)=>(u(),i("div",null,[Q(n("div",{ref_key:"scrimEl",ref:L,class:"fixed inset-0 z-40 bg-black pointer-events-none",style:{opacity:"0"}},null,512),[[ee,m.value]]),Q(n("div",{ref_key:"swipeIndicatorEl",ref:D,class:"swipe-indicator",style:{opacity:"0"}},[...e[5]||(e[5]=[n("div",{class:"swipe-chevron"},[n("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})])],-1),n("span",{class:"swipe-label"},null,-1)])],512),[[ee,m.value]]),n("div",{ref_key:"scrollContainer",ref:h,class:te(m.value?"fixed inset-0 z-50 overflow-y-auto overscroll-none bg-white dark:bg-neutral-950":""),onTouchstartPassive:ve,onTouchmove:fe,onTouchend:pe},[n("header",Ie,[n("div",He,[n("div",{class:"flex items-center gap-2 min-w-0"},[n("button",{onClick:X,class:"rounded-lg p-2 text-neutral-500 dark:text-neutral-400 hover:bg-neutral-200 dark:hover:bg-neutral-800 hover:text-neutral-800 dark:hover:text-neutral-200 transition-colors -ml-2","aria-label":"Go back"},[...e[6]||(e[6]=[n("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})],-1)])])]),n("div",Ne,[r.value?(u(),i("button",{key:0,onClick:le,class:te(["rounded-lg p-2 transition-colors cursor-pointer",g.value?"text-blue-400 hover:bg-neutral-200 dark:hover:bg-neutral-800":"text-neutral-500 dark:text-neutral-400 hover:bg-neutral-200 dark:hover:bg-neutral-800 hover:text-neutral-800 dark:hover:text-neutral-200"]),"aria-label":g.value?"Remove from Read Later":"Save to Read Later"},[(u(),i("svg",{class:"h-5 w-5",fill:g.value?"currentColor":"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[...e[7]||(e[7]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0111.186 0z"},null,-1)])],8,Be))],10,je)):v("",!0),r.value?(u(),i("button",{key:1,onClick:ue,class:"rounded-lg p-2 text-neutral-500 dark:text-neutral-400 hover:bg-neutral-200 dark:hover:bg-neutral-800 hover:text-neutral-800 dark:hover:text-neutral-200 transition-colors cursor-pointer","aria-label":"Share article"},[...e[8]||(e[8]=[n("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186l9.566-5.314m-9.566 7.5l9.566 5.314m0 0a2.25 2.25 0 103.935 2.186 2.25 2.25 0 00-3.935-2.186zm0-12.814a2.25 2.25 0 103.933-2.185 2.25 2.25 0 00-3.933 2.185z"})],-1)])])):v("",!0),r.value?(u(),i("div",{key:2,ref_key:"menuRef",ref:N,class:"relative"},[n("button",{onClick:ce,class:"rounded-lg p-2 text-neutral-500 dark:text-neutral-400 hover:bg-neutral-200 dark:hover:bg-neutral-800 hover:text-neutral-800 dark:hover:text-neutral-200 transition-colors cursor-pointer","aria-label":"More actions"},[...e[9]||(e[9]=[n("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM12.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM18.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"})],-1)])]),b.value?(u(),i("div",Xe,[n("button",{onClick:e[0]||(e[0]=a=>ie()),class:"flex w-full items-center gap-3 px-4 py-2.5 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors cursor-pointer"},[...e[10]||(e[10]=[n("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.75 9v.906a2.25 2.25 0 01-1.183 1.981l-6.478 3.488M2.25 9v.906a2.25 2.25 0 001.183 1.981l6.478 3.488m8.839 2.51l-4.66-2.51m0 0l-1.023-.55a2.25 2.25 0 00-2.134 0l-1.022.55m0 0l-4.661 2.51m16.5 1.615a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V8.844a2.25 2.25 0 011.183-1.98l7.5-4.04a2.25 2.25 0 012.134 0l7.5 4.04a2.25 2.25 0 011.183 1.98V18"})],-1),E(" Mark as unread ",-1)])]),r.value.url?(u(),i("button",{key:0,onClick:e[1]||(e[1]=a=>q()),class:"flex w-full items-center gap-3 px-4 py-2.5 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors cursor-pointer"},[...e[11]||(e[11]=[n("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"})],-1),E(" Open in browser ",-1)])])):v("",!0)])):v("",!0)],512)):v("",!0)])])]),H.value?(u(),i("div",Ve,[...e[12]||(e[12]=[n("svg",{class:"h-8 w-8 animate-spin text-neutral-400",fill:"none",viewBox:"0 0 24 24"},[n("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),n("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):r.value?(u(),i("div",$e,[n("article",{ref_key:"articleEl",ref:y,class:"mx-auto max-w-3xl px-4 py-6"},[n("header",Oe,[n("h1",Ye,[r.value.url?(u(),i("a",{key:0,href:r.value.url,target:"_blank",rel:"noopener noreferrer",class:"hover:text-blue-500 dark:hover:text-blue-400 transition-colors"},_(r.value.title),9,Pe)):(u(),i(Le,{key:1},[E(_(r.value.title),1)],64))]),n("div",qe,[r.value.feed_id?(u(),i("a",{key:0,href:"#",class:"flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-colors",onClick:e[2]||(e[2]=De(a=>we(r.value.feed_id),["prevent"]))},[r.value.feed_favicon_url?(u(),i("img",{key:0,src:r.value.feed_favicon_url,class:"h-4 w-4 rounded-sm",alt:""},null,8,Ue)):v("",!0),n("span",null,_(r.value.feed_title),1)])):v("",!0),r.value.author?(u(),i("span",Fe,"· "+_(r.value.author),1)):v("",!0),n("span",null,"· "+_(oe.value)+" at "+_(se.value),1)])]),ae.value?(u(),i("img",{key:0,src:r.value.image_url,alt:r.value.title,class:"mb-6 w-full max-h-80 object-cover rounded-lg",loading:"lazy"},null,8,We)):v("",!0),n("div",{class:"article-content prose max-w-none dark:prose-invert prose-headings:text-neutral-800 dark:prose-headings:text-neutral-200 prose-p:text-neutral-700 dark:prose-p:text-neutral-300 prose-a:text-blue-400 prose-a:no-underline hover:prose-a:underline prose-strong:text-neutral-800 dark:prose-strong:text-neutral-200 prose-code:text-blue-300 prose-pre:bg-neutral-50 dark:prose-pre:bg-neutral-900 prose-pre:border prose-pre:border-neutral-200 dark:prose-pre:border-neutral-800 prose-img:rounded-lg prose-blockquote:border-neutral-300 dark:prose-blockquote:border-neutral-700 prose-blockquote:text-neutral-500 dark:prose-blockquote:text-neutral-400",innerHTML:r.value.content||r.value.summary},null,8,Ge),!r.value.content&&!r.value.summary?(u(),i("div",Ze,[e[13]||(e[13]=n("p",{class:"text-neutral-500 dark:text-neutral-400"}," No article content available. ",-1)),r.value.url?(u(),i("button",{key:0,onClick:q,class:"mt-4 rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 transition-colors cursor-pointer"}," Read on original site ")):v("",!0)])):v("",!0),n("div",Ke,[k.value.prev?(u(),i("button",{key:0,onClick:e[3]||(e[3]=a=>S("prev")),class:"flex items-center gap-1 text-sm text-neutral-500 hover:text-neutral-800 dark:hover:text-neutral-200 transition-colors cursor-pointer"},[...e[14]||(e[14]=[n("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})],-1),E(" Previous ",-1)])])):(u(),i("div",Je)),k.value.next?(u(),i("button",{key:2,onClick:e[4]||(e[4]=a=>S("next")),class:"flex items-center gap-1 text-sm text-neutral-500 hover:text-neutral-800 dark:hover:text-neutral-200 transition-colors cursor-pointer"},[...e[15]||(e[15]=[E(" Next ",-1),n("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})],-1)])])):(u(),i("div",Qe))])],512)])):v("",!0)],34)]))}},dt=Ae(at,[["__scopeId","data-v-45068e3f"]]);export{dt as default};
