import{x as A,w as U,g as l,h as t,i as G,j as k,t as u,k as i,l as c,F as h,p as _,C,a as p,s as O,c as s}from"./app-zlAobjuY.js";import{u as H}from"./useToast-BQ-Ahw5a.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={class:"mx-auto max-w-lg px-4 py-6 space-y-5"},J={class:"rounded-xl bg-neutral-50 dark:bg-neutral-900 p-5"},K={key:0},Q={key:1},W={key:0,class:"mt-2 text-sm text-red-600 dark:text-red-400"},X=["disabled"],Y={key:0,class:"mr-2 h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none"},Z={key:0,class:"rounded-xl bg-neutral-50 dark:bg-neutral-900 p-5"},ee={class:"flex items-center justify-between mb-4"},te={class:"text-base font-medium text-neutral-800 dark:text-neutral-200"},re={class:"text-sm font-normal text-neutral-500 dark:text-neutral-400"},le={key:0},se={class:"flex items-center gap-2 mb-3 pb-3 border-b border-neutral-200 dark:border-neutral-800"},ae=["checked"],ne={class:"text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2 flex items-center gap-1.5"},oe={class:"space-y-1 pl-1"},ue=["onClick"],ie=["checked","disabled"],de=["src"],ce={key:1,class:"text-xs text-neutral-600 dark:text-neutral-500 shrink-0"},pe={key:0,class:"mb-4"},me={class:"space-y-1 pl-1"},xe=["onClick"],ve=["checked","disabled"],fe=["src"],be={key:1,class:"text-xs text-neutral-600 dark:text-neutral-500 shrink-0"},ke=["disabled"],ge={key:0,class:"mr-2 h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none"},he={__name:"OpmlImportView",setup(we){const F=A(),{success:V,error:L}=H(),m=p(null),x=p(""),f=p(!1),d=p(null),M=p(0),w=p(0),b=p(!1),o=p([]),v=C(()=>{if(!d.value)return[];const a=[];for(const e of d.value.categories)for(const r of e.feeds)r.is_duplicate||a.push(r.feed_url);for(const e of d.value.uncategorized)e.is_duplicate||a.push(e.feed_url);return a});U(()=>d.value,()=>{o.value=[...v.value]},{immediate:!0});const g=C(()=>o.value.length),j=C(()=>v.value.length>0&&o.value.length===v.value.length);function P(){j.value?o.value=[]:o.value=[...v.value]}function B(a){if(!v.value.includes(a))return;const e=o.value.indexOf(a);e>-1?o.value.splice(e,1):o.value.push(a)}function z(a){return o.value.includes(a)}function E(a){const e=a.target.files[0];e&&(m.value=e,x.value="")}async function $(){if(!m.value)return;f.value=!0,x.value="";const a=new FormData;a.append("file",m.value);try{const e=await O.post("/api/opml/preview",a,{headers:{"Content-Type":"multipart/form-data"}});d.value=e.data.preview,M.value=e.data.totalFeeds,w.value=e.data.duplicateCount}catch(e){if(e.response?.status===422){const r=e.response.data.errors||{};x.value=r.file?r.file[0]:"Invalid file"}else x.value=e.response?.data?.message||"Failed to parse OPML file"}finally{f.value=!1}}async function D(){if(g.value!==0){b.value=!0;try{const e=(await O.post("/api/opml/import",{selected_feeds:o.value})).data;V(`Imported ${e.imported} feed${e.imported!==1?"s":""}`+(e.skipped>0?`, ${e.skipped} skipped`:"")),F.push({name:"articles.index"})}catch(a){L(a.response?.data?.message||"Failed to import feeds")}finally{b.value=!1}}}function S(){window.location.href="/opml/export"}function N(){F.back()}return(a,e)=>(s(),l(h,null,[t("header",{class:"sticky top-0 z-30 border-b border-neutral-200 dark:border-neutral-800 bg-white/95 dark:bg-neutral-900/95 backdrop-blur supports-[backdrop-filter]:bg-white/80 dark:supports-[backdrop-filter]:bg-neutral-900/80 pt-safe"},[t("div",{class:"flex h-11 items-center justify-between px-4"},[t("div",{class:"flex items-center gap-2 min-w-0"},[t("button",{onClick:N,class:"rounded-lg p-2 text-neutral-500 dark:text-neutral-400 hover:bg-neutral-200 dark:hover:bg-neutral-800 hover:text-neutral-800 dark:hover:text-neutral-200 transition-colors -ml-2","aria-label":"Go back"},[...e[2]||(e[2]=[t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})],-1)])]),e[3]||(e[3]=t("h1",{class:"text-base font-semibold text-neutral-800 dark:text-neutral-200 truncate"}," Import / Export ",-1))])])]),t("div",q,[t("div",J,[e[6]||(e[6]=t("h2",{class:"text-base font-medium text-neutral-800 dark:text-neutral-200 mb-1"}," Import OPML ",-1)),e[7]||(e[7]=t("p",{class:"text-sm text-neutral-500 dark:text-neutral-400 mb-4"}," Upload an .opml or .xml file to import feeds from another reader. ",-1)),t("form",{onSubmit:G($,["prevent"])},[t("div",null,[t("label",{class:k(["flex cursor-pointer items-center justify-center gap-2 rounded-lg border-2 border-dashed border-neutral-300 bg-white px-4 py-6 text-sm text-neutral-500 dark:text-neutral-400 transition hover:border-neutral-400 hover:text-neutral-700 dark:border-neutral-700 dark:bg-neutral-800 dark:hover:border-neutral-600 dark:hover:text-neutral-300",{"border-blue-500 text-blue-400":m.value}])},[e[4]||(e[4]=t("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),m.value?(s(),l("span",K,u(m.value.name),1)):(s(),l("span",Q,"Choose .opml or .xml file")),t("input",{type:"file",accept:".opml,.xml",class:"hidden",onChange:E},null,32)],2),x.value?(s(),l("p",W,u(x.value),1)):i("",!0)]),t("button",{type:"submit",class:"mt-4 w-full inline-flex items-center justify-center rounded-lg bg-blue-600 px-4 py-3 text-sm font-medium text-white transition hover:bg-blue-700 disabled:opacity-25",disabled:f.value||!m.value},[f.value?(s(),l("svg",Y,[...e[5]||(e[5]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):i("",!0),c(" "+u(f.value?"Parsing...":"Upload & Preview"),1)],8,X)],32)]),d.value?(s(),l("div",Z,[t("div",ee,[t("h2",te,[e[9]||(e[9]=c(" Preview ",-1)),t("span",re,[c(" ("+u(M.value)+" feeds found",1),w.value?(s(),l("span",le,", "+u(w.value)+" already subscribed",1)):i("",!0),e[8]||(e[8]=c(") ",-1))])])]),t("div",se,[t("div",{class:"flex items-center gap-2 text-sm text-neutral-700 dark:text-neutral-300 cursor-pointer",onClick:P},[t("input",{type:"checkbox",checked:j.value,class:"rounded border-neutral-300 bg-white text-blue-500 focus:ring-blue-500 focus:ring-offset-white dark:border-neutral-600 dark:bg-neutral-800 dark:focus:ring-offset-neutral-900 pointer-events-none"},null,8,ae),c(" Select all new feeds ("+u(v.value.length)+") ",1)])]),(s(!0),l(h,null,_(d.value.categories,(r,y)=>(s(),l("div",{key:y,class:"mb-4"},[t("h3",ne,[e[10]||(e[10]=t("svg",{class:"h-4 w-4 text-neutral-600 dark:text-neutral-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})],-1)),c(" "+u(r.name),1)]),t("div",oe,[(s(!0),l(h,null,_(r.feeds,(n,T)=>(s(),l("div",{key:T,class:k(["flex items-center gap-2.5 rounded-lg px-3 py-2 text-sm transition",n.is_duplicate?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-neutral-200 dark:hover:bg-neutral-800"]),onClick:I=>!n.is_duplicate&&B(n.feed_url)},[t("input",{type:"checkbox",checked:n.is_duplicate?!1:z(n.feed_url),disabled:n.is_duplicate,class:"rounded border-neutral-300 bg-white text-blue-500 focus:ring-blue-500 focus:ring-offset-white dark:border-neutral-600 dark:bg-neutral-800 dark:focus:ring-offset-neutral-900 disabled:opacity-40 pointer-events-none"},null,8,ie),n.favicon_url?(s(),l("img",{key:0,src:n.favicon_url,class:"h-4 w-4 rounded",onError:e[0]||(e[0]=I=>I.target.style.display="none")},null,40,de)):i("",!0),t("span",{class:k(["flex-1 truncate",n.is_duplicate?"text-neutral-500 line-through":"text-neutral-800 dark:text-neutral-200"])},u(n.title),3),n.is_duplicate?(s(),l("span",ce,"subscribed")):i("",!0)],10,ue))),128))])]))),128)),d.value.uncategorized.length>0?(s(),l("div",pe,[e[11]||(e[11]=t("h3",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2 flex items-center gap-1.5"},[t("svg",{class:"h-4 w-4 text-neutral-600 dark:text-neutral-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 110-2 1 1 0 010 2z"})]),c(" Uncategorized ")],-1)),t("div",me,[(s(!0),l(h,null,_(d.value.uncategorized,(r,y)=>(s(),l("div",{key:y,class:k(["flex items-center gap-2.5 rounded-lg px-3 py-2 text-sm transition",r.is_duplicate?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-neutral-200 dark:hover:bg-neutral-800"]),onClick:n=>!r.is_duplicate&&B(r.feed_url)},[t("input",{type:"checkbox",checked:r.is_duplicate?!1:z(r.feed_url),disabled:r.is_duplicate,class:"rounded border-neutral-300 bg-white text-blue-500 focus:ring-blue-500 focus:ring-offset-white dark:border-neutral-600 dark:bg-neutral-800 dark:focus:ring-offset-neutral-900 disabled:opacity-40 pointer-events-none"},null,8,ve),r.favicon_url?(s(),l("img",{key:0,src:r.favicon_url,class:"h-4 w-4 rounded",onError:e[1]||(e[1]=n=>n.target.style.display="none")},null,40,fe)):i("",!0),t("span",{class:k(["flex-1 truncate",r.is_duplicate?"text-neutral-500 line-through":"text-neutral-800 dark:text-neutral-200"])},u(r.title),3),r.is_duplicate?(s(),l("span",be,"subscribed")):i("",!0)],10,xe))),128))])])):i("",!0),t("button",{class:"mt-2 w-full inline-flex items-center justify-center rounded-lg bg-blue-600 px-4 py-3 text-sm font-medium text-white transition hover:bg-blue-700 disabled:opacity-25",disabled:b.value||g.value===0,onClick:D},[b.value?(s(),l("svg",ge,[...e[12]||(e[12]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):i("",!0),c(" "+u(b.value?"Importing...":`Import ${g.value} Feed${g.value!==1?"s":""}`),1)],8,ke)])):i("",!0),t("div",{class:"rounded-xl bg-neutral-50 dark:bg-neutral-900 p-5"},[e[14]||(e[14]=t("h2",{class:"text-base font-medium text-neutral-800 dark:text-neutral-200 mb-1"}," Export OPML ",-1)),e[15]||(e[15]=t("p",{class:"text-sm text-neutral-500 dark:text-neutral-400 mb-4"}," Download your subscriptions as an OPML file for backup or migration. ",-1)),t("button",{onClick:S,class:"flex w-full items-center justify-center gap-2 rounded-lg bg-neutral-200 dark:bg-neutral-800 px-4 py-3 text-sm font-medium text-neutral-800 dark:text-neutral-200 transition hover:bg-neutral-300 dark:hover:bg-neutral-700"},[...e[13]||(e[13]=[t("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),c(" Download OPML File ",-1)])])])])],64))}},Fe=R(he,[["__scopeId","data-v-9945daaa"]]);export{Fe as default};
