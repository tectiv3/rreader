import{x as ce,z as de,o as F,b as H,w as ve,g as o,m as fe,N as pe,h as n,j as P,k as u,l as _,t as x,F as me,i as he,U as ke,a as d,E as C,c as l}from"./app-C8tzHcA2.js";import{u as ge}from"./useArticleStore-DIn-f_J2.js";import{u as xe}from"./useToast-DbDOB-Qo.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useSidebarStore-Bb3Q8CNV.js";const ye={class:"sticky top-0 z-30 border-b border-neutral-200 dark:border-neutral-800 bg-white/95 dark:bg-neutral-900/95 backdrop-blur supports-[backdrop-filter]:bg-white/80 dark:supports-[backdrop-filter]:bg-neutral-900/80 pt-safe"},we={class:"flex h-11 items-center justify-between px-4"},_e={class:"flex items-center gap-1 shrink-0"},Te=["aria-label"],Me=["fill"],Ce={key:0,class:"absolute right-0 top-full mt-1 w-48 rounded-lg border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 shadow-lg py-1 z-50"},Le={key:0,class:"flex items-center justify-center py-20"},Se={key:1,class:"overflow-x-hidden"},Re={class:"mb-6"},De={class:"text-2xl font-bold leading-tight text-neutral-900 dark:text-neutral-100"},Ee=["href"],ze={class:"mt-3 flex flex-wrap items-center gap-x-3 gap-y-1 text-sm text-neutral-500 dark:text-neutral-400"},Ae=["src"],je={key:1},Be=["src","alt"],Ie=["innerHTML"],He={key:1,class:"py-12 text-center"},Ne={class:"mt-8 flex items-center justify-between border-t border-neutral-200 dark:border-neutral-800 pt-4"},Ve={key:1},Ye={key:3},Oe=150,Xe=10,G=80,$e=1.5,Ue={__name:"ArticleDetailView",setup(qe){const h=ge(),b=ce(),L=de(),{success:S}=xe(),r=d(null),R=d(!0),p=d(!1),k=d(!1),D=d(null),E=d(null),y=d(!1),m=d(!1),v=d(null);function z(){const t=window.innerWidth<1024;m.value!==t&&(m.value=t)}F(()=>{z(),window.addEventListener("resize",z)}),H(()=>{window.removeEventListener("resize",z)});function K(t){window.__swReady?.then(e=>{e&&e.postMessage({type:"save-reading-state",state:{url:t}})})}function N(){window.__swReady?.then(t=>{t&&t.postMessage({type:"clear-reading-state"})})}H(()=>N());async function V(t){R.value=!0,r.value=null,m.value&&v.value?v.value.scrollTop=0:window.scrollTo(0,0);const e=`/articles/${t}`;K(e);try{const a=await h.fetchContent(Number(t));r.value=a,p.value=a.is_read_later??!1,ke(a.title),h.markRead(Number(t)),h.prefetchAdjacent(Number(t))}catch{N(),b.replace({name:"articles.index"})}finally{R.value=!1}}V(L.params.id),ve(()=>L.params.id,t=>{t&&L.name==="articles.show"&&(y.value=!1,V(t))});const T=C(()=>r.value?h.adjacentIds(r.value.id):{prev:null,next:null});function g(t){if(y.value)return;const e=t==="next"?T.value.next:T.value.prev;e&&(y.value=!0,sessionStorage.setItem("article-swipe-direction",t),b.replace({name:"articles.show",params:{id:e}}))}const W=C(()=>r.value?.image_url?!(r.value.content||r.value.summary||"").includes(r.value.image_url):!1),Z=C(()=>r.value?new Date(r.value.published_at).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):""),J=C(()=>r.value?new Date(r.value.published_at).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):"");function A(){window.history.length>1?b.back():b.push({name:"articles.index"})}function Q(){r.value&&(h.toggleReadLater(r.value.id),p.value=!p.value,S(p.value?"Article saved":"Removed from Read Later"))}function ee(){r.value&&(k.value=!1,h.markUnread(r.value.id),S("Marked as unread"))}function Y(){if(r.value?.url){k.value=!1;try{const t=new URL(r.value.url);(t.protocol==="http:"||t.protocol==="https:")&&window.open(t.href,"_blank","noopener,noreferrer")}catch{}}}function te(){r.value&&(navigator.share?navigator.share({title:r.value.title,url:r.value.url}).catch(()=>{}):r.value.url&&navigator.clipboard.writeText(r.value.url).then(()=>{S("Link copied to clipboard")}).catch(()=>{}))}function re(){k.value=!k.value}function O(t){D.value&&!D.value.contains(t.target)&&(k.value=!1)}function X(t){t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"||t.target.isContentEditable||(t.key==="ArrowRight"||t.key==="j"?g("next"):t.key==="ArrowLeft"||t.key==="k"?g("prev"):t.key==="Escape"&&A())}F(()=>{document.addEventListener("click",O),document.addEventListener("keydown",X);const t=sessionStorage.getItem("article-swipe-direction");if(t&&E.value){sessionStorage.removeItem("article-swipe-direction");const e=E.value,a=t==="next"?"40%":"-40%";e.style.transition="none",e.style.transform=`translateX(${a})`,e.offsetHeight,e.style.transition="transform 160ms ease-out",e.style.transform="translateX(0)",e.addEventListener("transitionend",()=>{e.style.transition="",e.style.transform=""},{once:!0})}}),H(()=>{document.removeEventListener("click",O),document.removeEventListener("keydown",X),s="idle",B()});const w=d(null);let j=0,M=0,$=0,s="idle",U=!1;function ne(t){if(s==="animating"||!m.value||y.value)return;j=t.touches[0].clientX,M=t.touches[0].clientY,$=Date.now();const e=v.value;U=e?e.scrollTop<=0:!1,s="tracking"}function ae(t){if(s==="idle"||s==="animating"||!m.value)return;const e=t.touches[0].clientX-j,a=t.touches[0].clientY-M,i=Math.abs(e),c=Math.abs(a);if(s==="tracking"){if(Math.sqrt(i*i+c*c)<Xe)return;if(c>i&&a>0&&U)s="dismissing",t.preventDefault();else{s="horizontal";return}}if(s==="dismissing"){t.preventDefault();const f=Math.max(0,t.touches[0].clientY-M);le(f)}}function oe(t){const e=s,a=t.changedTouches[0].clientX-j,i=t.changedTouches[0].clientY-M;if(e==="horizontal"){if(s="idle",y.value)return;a<-G?g("next"):a>G&&g("prev");return}if(e==="dismissing"){const c=Date.now()-$,f=i/c,I=window.innerHeight*.3,q=Math.max(0,i)*.6;q>Oe||q>I||f>$e?se():ie();return}s="idle"}function le(t){const e=v.value,a=w.value;if(!e)return;const i=t*.6,c=window.innerHeight*.5,f=Math.min(i/c,1),I=1-.08*f;e.style.transition="none",e.style.transform=`translateY(${i}px) scale(${I})`,e.style.transformOrigin="top center",e.style.borderRadius=`${12*f}px`,a&&(a.style.transition="none",a.style.opacity=String(.5*f))}function se(){s="animating";const t=v.value,e=w.value;if(!t)return;t.style.transition="transform 250ms ease-in, border-radius 250ms ease-in",t.style.transform="translateY(100vh) scale(0.9)",t.style.borderRadius="12px",e&&(e.style.transition="opacity 250ms ease-in",e.style.opacity="0");let a=!1;const i=()=>{a||(a=!0,clearTimeout(c),s="idle",B(),A())},c=setTimeout(i,400);t.addEventListener("transitionend",i,{once:!0})}function ie(){s="animating";const t=v.value,e=w.value;if(!t)return;t.style.transition="transform 300ms cubic-bezier(0.2, 0.9, 0.3, 1.0), border-radius 300ms ease-out",t.style.transform="translateY(0) scale(1)",t.style.borderRadius="0px",e&&(e.style.transition="opacity 300ms ease-out",e.style.opacity="0");let a=!1;const i=()=>{a||(a=!0,clearTimeout(c),s="idle",B())},c=setTimeout(i,450);t.addEventListener("transitionend",i,{once:!0})}function B(){const t=v.value,e=w.value;t&&(t.style.transition="",t.style.transform="",t.style.transformOrigin="",t.style.borderRadius=""),e&&(e.style.transition="",e.style.opacity="0")}function ue(t){b.push({name:"articles.index",query:{feed_id:t}})}return(t,e)=>(l(),o("div",null,[fe(n("div",{ref_key:"scrimEl",ref:w,class:"fixed inset-0 z-40 bg-black pointer-events-none",style:{opacity:"0"}},null,512),[[pe,m.value]]),n("div",{ref_key:"scrollContainer",ref:v,class:P(m.value?"fixed inset-0 z-50 overflow-y-auto overscroll-none bg-white dark:bg-neutral-950":""),onTouchstartPassive:ne,onTouchmove:ae,onTouchend:oe},[n("header",ye,[n("div",we,[n("div",{class:"flex items-center gap-2 min-w-0"},[n("button",{onClick:A,class:"rounded-lg p-2 text-neutral-500 dark:text-neutral-400 hover:bg-neutral-200 dark:hover:bg-neutral-800 hover:text-neutral-800 dark:hover:text-neutral-200 transition-colors -ml-2","aria-label":"Go back"},[...e[5]||(e[5]=[n("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})],-1)])])]),n("div",_e,[r.value?(l(),o("button",{key:0,onClick:Q,class:P(["rounded-lg p-2 transition-colors cursor-pointer",p.value?"text-blue-400 hover:bg-neutral-200 dark:hover:bg-neutral-800":"text-neutral-500 dark:text-neutral-400 hover:bg-neutral-200 dark:hover:bg-neutral-800 hover:text-neutral-800 dark:hover:text-neutral-200"]),"aria-label":p.value?"Remove from Read Later":"Save to Read Later"},[(l(),o("svg",{class:"h-5 w-5",fill:p.value?"currentColor":"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[...e[6]||(e[6]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0111.186 0z"},null,-1)])],8,Me))],10,Te)):u("",!0),r.value?(l(),o("button",{key:1,onClick:te,class:"rounded-lg p-2 text-neutral-500 dark:text-neutral-400 hover:bg-neutral-200 dark:hover:bg-neutral-800 hover:text-neutral-800 dark:hover:text-neutral-200 transition-colors cursor-pointer","aria-label":"Share article"},[...e[7]||(e[7]=[n("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186l9.566-5.314m-9.566 7.5l9.566 5.314m0 0a2.25 2.25 0 103.935 2.186 2.25 2.25 0 00-3.935-2.186zm0-12.814a2.25 2.25 0 103.933-2.185 2.25 2.25 0 00-3.933 2.185z"})],-1)])])):u("",!0),r.value?(l(),o("div",{key:2,ref_key:"menuRef",ref:D,class:"relative"},[n("button",{onClick:re,class:"rounded-lg p-2 text-neutral-500 dark:text-neutral-400 hover:bg-neutral-200 dark:hover:bg-neutral-800 hover:text-neutral-800 dark:hover:text-neutral-200 transition-colors cursor-pointer","aria-label":"More actions"},[...e[8]||(e[8]=[n("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM12.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM18.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"})],-1)])]),k.value?(l(),o("div",Ce,[n("button",{onClick:e[0]||(e[0]=a=>ee()),class:"flex w-full items-center gap-3 px-4 py-2.5 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors cursor-pointer"},[...e[9]||(e[9]=[n("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.75 9v.906a2.25 2.25 0 01-1.183 1.981l-6.478 3.488M2.25 9v.906a2.25 2.25 0 001.183 1.981l6.478 3.488m8.839 2.51l-4.66-2.51m0 0l-1.023-.55a2.25 2.25 0 00-2.134 0l-1.022.55m0 0l-4.661 2.51m16.5 1.615a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V8.844a2.25 2.25 0 011.183-1.98l7.5-4.04a2.25 2.25 0 012.134 0l7.5 4.04a2.25 2.25 0 011.183 1.98V18"})],-1),_(" Mark as unread ",-1)])]),r.value.url?(l(),o("button",{key:0,onClick:e[1]||(e[1]=a=>Y()),class:"flex w-full items-center gap-3 px-4 py-2.5 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors cursor-pointer"},[...e[10]||(e[10]=[n("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"})],-1),_(" Open in browser ",-1)])])):u("",!0)])):u("",!0)],512)):u("",!0)])])]),R.value?(l(),o("div",Le,[...e[11]||(e[11]=[n("svg",{class:"h-8 w-8 animate-spin text-neutral-400",fill:"none",viewBox:"0 0 24 24"},[n("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),n("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):r.value?(l(),o("div",Se,[n("article",{ref_key:"articleEl",ref:E,class:"mx-auto max-w-3xl px-4 py-6"},[n("header",Re,[n("h1",De,[r.value.url?(l(),o("a",{key:0,href:r.value.url,target:"_blank",rel:"noopener noreferrer",class:"hover:text-blue-500 dark:hover:text-blue-400 transition-colors"},x(r.value.title),9,Ee)):(l(),o(me,{key:1},[_(x(r.value.title),1)],64))]),n("div",ze,[r.value.feed_id?(l(),o("a",{key:0,href:"#",class:"flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-colors",onClick:e[2]||(e[2]=he(a=>ue(r.value.feed_id),["prevent"]))},[r.value.feed_favicon_url?(l(),o("img",{key:0,src:r.value.feed_favicon_url,class:"h-4 w-4 rounded-sm",alt:""},null,8,Ae)):u("",!0),n("span",null,x(r.value.feed_title),1)])):u("",!0),r.value.author?(l(),o("span",je,"· "+x(r.value.author),1)):u("",!0),n("span",null,"· "+x(Z.value)+" at "+x(J.value),1)])]),W.value?(l(),o("img",{key:0,src:r.value.image_url,alt:r.value.title,class:"mb-6 w-full max-h-80 object-cover rounded-lg",loading:"lazy"},null,8,Be)):u("",!0),n("div",{class:"article-content prose max-w-none dark:prose-invert prose-headings:text-neutral-800 dark:prose-headings:text-neutral-200 prose-p:text-neutral-700 dark:prose-p:text-neutral-300 prose-a:text-blue-400 prose-a:no-underline hover:prose-a:underline prose-strong:text-neutral-800 dark:prose-strong:text-neutral-200 prose-code:text-blue-300 prose-pre:bg-neutral-50 dark:prose-pre:bg-neutral-900 prose-pre:border prose-pre:border-neutral-200 dark:prose-pre:border-neutral-800 prose-img:rounded-lg prose-blockquote:border-neutral-300 dark:prose-blockquote:border-neutral-700 prose-blockquote:text-neutral-500 dark:prose-blockquote:text-neutral-400",innerHTML:r.value.content||r.value.summary},null,8,Ie),!r.value.content&&!r.value.summary?(l(),o("div",He,[e[12]||(e[12]=n("p",{class:"text-neutral-500 dark:text-neutral-400"}," No article content available. ",-1)),r.value.url?(l(),o("button",{key:0,onClick:Y,class:"mt-4 rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 transition-colors cursor-pointer"}," Read on original site ")):u("",!0)])):u("",!0),n("div",Ne,[T.value.prev?(l(),o("button",{key:0,onClick:e[3]||(e[3]=a=>g("prev")),class:"flex items-center gap-1 text-sm text-neutral-500 hover:text-neutral-800 dark:hover:text-neutral-200 transition-colors cursor-pointer"},[...e[13]||(e[13]=[n("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})],-1),_(" Previous ",-1)])])):(l(),o("div",Ve)),T.value.next?(l(),o("button",{key:2,onClick:e[4]||(e[4]=a=>g("next")),class:"flex items-center gap-1 text-sm text-neutral-500 hover:text-neutral-800 dark:hover:text-neutral-200 transition-colors cursor-pointer"},[...e[14]||(e[14]=[_(" Next ",-1),n("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})],-1)])])):(l(),o("div",Ye))])],512)])):u("",!0)],34)]))}},Ze=be(Ue,[["__scopeId","data-v-bf62f216"]]);export{Ze as default};
