import{R as L,a as s,C as _,s as c}from"./app-dOP042_d.js";const O=L("articles",()=>{const r=s([]),n=s(new Map),i=new Map,l=s({type:"all"}),o=s(!1),d=s(!1),v=s("All Feeds"),g=20,I=_(()=>r.value.filter(e=>!e.is_read).length),m=_(()=>r.value.filter(e=>e.is_read_later).length),C=_(()=>{const e={};for(const t of r.value)t.is_read||(e[t.feed_id]=(e[t.feed_id]||0)+1);return e});function x(e){return n.value.get(e)??null}function p(e){const t=r.value.findIndex(a=>a.id===e);return t===-1?{prev:null,next:null}:{prev:t>0?r.value[t-1].id:null,next:t<r.value.length-1?r.value[t+1].id:null}}async function y(e){if(d.value&&l.value.type===e.type&&l.value.feedId===e.feedId&&l.value.categoryId===e.categoryId)return;o.value=!0,l.value=e;const t=new URLSearchParams;e.feedId&&t.set("feed_id",e.feedId),e.categoryId&&t.set("category_id",e.categoryId),e.type==="today"&&t.set("filter","today"),e.type==="read_later"&&t.set("filter","read_later"),e.type==="recently_read"&&t.set("filter","recently_read");try{const a=await c.get("/api/articles?"+t.toString());r.value=a.data.articles,v.value=a.data.filter_title,d.value=!0}finally{o.value=!1}}async function f(e){const t=n.value.get(e);if(t)return n.value.delete(e),n.value.set(e,t),t;if(i.has(e))return i.get(e);const a=c.get(`/api/articles/${e}`).then(u=>{const h=u.data;if(n.value.set(e,h),n.value.size>g){const F=n.value.keys().next().value;n.value.delete(F)}return i.delete(e),h}).catch(u=>{throw i.delete(e),u});return i.set(e,a),a}function S(e){const{prev:t,next:a}=p(e);a&&f(a).catch(()=>{}),t&&f(t).catch(()=>{})}function A(e){const t=r.value.find(a=>a.id===e);!t||t.is_read||(t.is_read=!0,t.read_at=new Date().toISOString(),c.patch(`/api/articles/${e}`,{is_read:!0}).catch(()=>{t.is_read=!1,t.read_at=null}))}function R(e){const t=r.value.find(a=>a.id===e);!t||!t.is_read||(t.is_read=!1,t.read_at=null,c.patch(`/api/articles/${e}`,{is_read:!1}).catch(()=>{t.is_read=!0}))}function k(e){const t=r.value.find(u=>u.id===e);if(!t)return;const a=t.is_read_later;t.is_read_later=!a,c.patch(`/api/articles/${e}`,{is_read_later:!a}).catch(()=>{t.is_read_later=a})}function E(e=null){const t=e?r.value.filter(a=>a.feed_id===e&&!a.is_read):r.value.filter(a=>!a.is_read);t.forEach(a=>{a.is_read=!0,a.read_at=new Date().toISOString()}),c.post("/api/articles/mark-all-read",{feed_id:l.value.feedId??null,category_id:l.value.categoryId??null,filter:["today","read_later"].includes(l.value.type)?l.value.type:null}).catch(()=>{t.forEach(a=>{a.is_read=!1,a.read_at=null})})}function $(){return d.value=!1,y(l.value)}return{articles:r,contentCache:n,activeView:l,loading:o,loaded:d,filterTitle:v,unreadCount:I,readLaterCount:m,unreadByFeed:C,getContent:x,adjacentIds:p,fetchArticles:y,fetchContent:f,prefetchAdjacent:S,markRead:A,markUnread:R,toggleReadLater:k,markAllRead:E,forceRefresh:$}});export{O as u};
