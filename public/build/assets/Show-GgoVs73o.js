import{h as f,j as P,m as re,c as o,a as _,u as j,q as ae,w as M,d as a,o as i,t as m,F as U,e as R,v as le,g as v,b as c,n as ne,y as C}from"./app-BstCr2jQ.js";import{a as oe,b as ie,A as se,c as ue}from"./AppLayout-Xlll8SCP.js";import{u as ce,a as de}from"./useArticleReadState-D0R3YCuA.js";import"./TextInput-H9FRVrrD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const fe=["disabled","aria-label"],ve=["fill"],he={key:0,class:"absolute right-0 top-full mt-1 w-48 rounded-lg border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 shadow-lg py-1 z-50"},me=["disabled"],ge={class:"overflow-x-hidden"},ke={class:"mb-6"},xe={class:"text-2xl font-bold leading-tight text-neutral-900 dark:text-neutral-100"},pe=["href"],be={class:"mt-3 flex flex-wrap items-center gap-x-3 gap-y-1 text-sm text-neutral-500 dark:text-neutral-400"},ye=["href"],we=["src"],Ae={key:1},Se=["src","alt"],Le=["innerHTML"],Me={key:1,class:"py-12 text-center"},z=80,H=30,d=160,b=45,Re="10m",$e={__name:"Show",props:{article:Object,prevArticleId:Number,nextArticleId:Number,context:{type:Object,default:()=>({})}},setup(l){const t=l;function y(r){const e=new URLSearchParams;t.context.feed_id&&e.set("feed_id",t.context.feed_id),t.context.category_id&&e.set("category_id",t.context.category_id),t.context.filter&&e.set("filter",t.context.filter);const n=e.toString();return route("articles.show",r)+(n?"?"+n:"")}const{isOnline:I}=oe(),{enqueue:E}=ie(),{success:g}=ue(),{saveReadingState:O,clearReadingState:V}=ce(),{markRead:X,markUnread:q}=de(),u=f(t.article.is_read_later??!1),x=f(!1),p=f(!1),s=f(null),w=f(!1),h=f(!1),A=f(null);function D(){h.value=!h.value}function T(r){A.value&&!A.value.contains(r.target)&&(h.value=!1)}P(()=>{document.addEventListener("click",T)}),re(()=>{document.removeEventListener("click",T),V()});const F=C(()=>t.article.image_url?!(t.article.content||t.article.summary||"").includes(t.article.image_url):!1),W=C(()=>new Date(t.article.published_at).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})),Y=C(()=>new Date(t.article.published_at).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}));function G(){if(window.history.length>1){window.history.back();return}const r={};t.context.feed_id&&(r.feed_id=t.context.feed_id),t.context.category_id&&(r.category_id=t.context.category_id),t.context.filter&&(r.filter=t.context.filter),v.get(route("articles.index",r))}function J(){if(x.value=!0,!I.value){u.value=!u.value,E("post",route("articles.toggleReadLater",t.article.id),{}),x.value=!1,g(u.value?"Article saved":"Removed from Read Later");return}axios.post(route("articles.toggleReadLater",t.article.id)).then(()=>{u.value=!u.value,g(u.value?"Article saved":"Removed from Read Later")}).finally(()=>{x.value=!1})}function Q(){if(p.value=!0,h.value=!1,q(t.article.id),!I.value){E("post",route("articles.markAsUnread",t.article.id),{}),p.value=!1,g("Marked as unread");return}axios.post(route("articles.markAsUnread",t.article.id)).then(()=>{g("Marked as unread")}).finally(()=>{p.value=!1})}function N(){if(t.article.url){h=!1;try{const r=new URL(t.article.url);(r.protocol==="http:"||r.protocol==="https:")&&window.open(r.href,"_blank","noopener,noreferrer")}catch{}}}function K(){navigator.share?navigator.share({title:t.article.title,url:t.article.url}).catch(()=>{}):t.article.url&&navigator.clipboard.writeText(t.article.url).then(()=>{g("Link copied to clipboard")}).catch(()=>{})}let $=0,B=0;function Z(){const r=[t.nextArticleId,t.prevArticleId].filter(Boolean);if(!r.length)return;const e=n=>{const k=r[n];if(!k)return;const S=y(k),L={method:"get"};if(v.getCached(S,L)||v.getPrefetching(S,L)){e(n+1);return}v.prefetch(S,{...L,onPrefetched:()=>e(n+1),onPrefetchError:()=>e(n+1),onCancel:()=>e(n+1)},{cacheFor:Re})};e(0)}P(()=>{X(t.article.id,t.article.feed?.id),O({url:window.location.pathname+window.location.search,selectedArticleId:t.article.id}),Z();const r=sessionStorage.getItem("article-swipe-direction");if(r&&s.value){sessionStorage.removeItem("article-swipe-direction");const e=s.value;e.style.transition="none",e.style.transform=r==="next"?`translateX(${b}%)`:`translateX(-${b}%)`,e.style.opacity="0",e.offsetHeight,e.style.transition=`transform ${d}ms ease-out, opacity ${d}ms ease-out`,e.style.transform="translateX(0)",e.style.opacity="1",e.addEventListener("transitionend",()=>{e.style.transition="",e.style.transform="",e.style.opacity=""},{once:!0})}});function ee(r){$=r.touches[0].clientX,B=r.touches[0].clientY}function te(r){if(w.value)return;const e=r.changedTouches[0].clientX-$,n=r.changedTouches[0].clientY-B,k=Math.abs(Math.atan2(n,e)*180/Math.PI);k>H&&k<180-H||(e<-z&&t.nextArticleId?(w.value=!0,sessionStorage.setItem("article-swipe-direction","next"),s.value&&(s.value.style.transition=`transform ${d}ms ease-out, opacity ${d}ms ease-out`,s.value.style.transform=`translateX(-${b}%)`,s.value.style.opacity="0"),setTimeout(()=>v.visit(y(t.nextArticleId),{replace:!0}),d)):e>z&&t.prevArticleId&&(w.value=!0,sessionStorage.setItem("article-swipe-direction","prev"),s.value&&(s.value.style.transition=`transform ${d}ms ease-out, opacity ${d}ms ease-out`,s.value.style.transform=`translateX(${b}%)`,s.value.style.opacity="0"),setTimeout(()=>v.visit(y(t.prevArticleId),{replace:!0}),d)))}return(r,e)=>(i(),o(U,null,[_(j(ae),{title:l.article.title},null,8,["title"]),_(se,null,{"header-left":M(()=>[a("button",{onClick:G,class:"rounded-lg p-2 text-neutral-500 dark:text-neutral-400 hover:bg-neutral-200 dark:hover:bg-neutral-800 hover:text-neutral-800 dark:hover:text-neutral-200 transition-colors -ml-2","aria-label":"Go back"},[...e[3]||(e[3]=[a("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})],-1)])])]),"header-right":M(()=>[a("button",{onClick:J,disabled:x.value,class:ne(["rounded-lg p-2 transition-colors",u.value?"text-blue-400 hover:bg-neutral-200 dark:hover:bg-neutral-800":"text-neutral-500 dark:text-neutral-400 hover:bg-neutral-200 dark:hover:bg-neutral-800 hover:text-neutral-800 dark:hover:text-neutral-200"]),"aria-label":u.value?"Remove from Read Later":"Save to Read Later"},[(i(),o("svg",{class:"h-5 w-5",fill:u.value?"currentColor":"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[...e[4]||(e[4]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0111.186 0z"},null,-1)])],8,ve))],10,fe),a("button",{onClick:K,class:"rounded-lg p-2 text-neutral-500 dark:text-neutral-400 hover:bg-neutral-200 dark:hover:bg-neutral-800 hover:text-neutral-800 dark:hover:text-neutral-200 transition-colors","aria-label":"Share article"},[...e[5]||(e[5]=[a("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186l9.566-5.314m-9.566 7.5l9.566 5.314m0 0a2.25 2.25 0 103.935 2.186 2.25 2.25 0 00-3.935-2.186zm0-12.814a2.25 2.25 0 103.933-2.185 2.25 2.25 0 00-3.933 2.185z"})],-1)])]),a("div",{ref_key:"menuRef",ref:A,class:"relative"},[a("button",{onClick:D,class:"rounded-lg p-2 text-neutral-500 dark:text-neutral-400 hover:bg-neutral-200 dark:hover:bg-neutral-800 hover:text-neutral-800 dark:hover:text-neutral-200 transition-colors","aria-label":"More actions"},[...e[6]||(e[6]=[a("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM12.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM18.75 12a.75.75 0 11-1.5 0 .75.75 0 011.5 0z"})],-1)])]),h.value?(i(),o("div",he,[a("button",{onClick:e[0]||(e[0]=n=>Q()),disabled:p.value,class:"flex w-full items-center gap-3 px-4 py-2.5 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors"},[...e[7]||(e[7]=[a("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.75 9v.906a2.25 2.25 0 01-1.183 1.981l-6.478 3.488M2.25 9v.906a2.25 2.25 0 001.183 1.981l6.478 3.488m8.839 2.51l-4.66-2.51m0 0l-1.023-.55a2.25 2.25 0 00-2.134 0l-1.022.55m0 0l-4.661 2.51m16.5 1.615a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V8.844a2.25 2.25 0 011.183-1.98l7.5-4.04a2.25 2.25 0 012.134 0l7.5 4.04a2.25 2.25 0 011.183 1.98V18"})],-1),R(" Mark as unread ",-1)])],8,me),l.article.url?(i(),o("button",{key:0,onClick:e[1]||(e[1]=n=>N()),class:"flex w-full items-center gap-3 px-4 py-2.5 text-sm text-neutral-700 dark:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors"},[...e[8]||(e[8]=[a("svg",{class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"})],-1),R(" Open in browser ",-1)])])):c("",!0)])):c("",!0)],512)]),default:M(()=>[a("div",ge,[a("article",{ref_key:"articleEl",ref:s,class:"mx-auto max-w-3xl px-4 py-6",onTouchstartPassive:ee,onTouchend:te},[a("header",ke,[a("h1",xe,[l.article.url?(i(),o("a",{key:0,href:l.article.url,target:"_blank",rel:"noopener noreferrer",class:"hover:text-blue-500 dark:hover:text-blue-400 transition-colors"},m(l.article.title),9,pe)):(i(),o(U,{key:1},[R(m(l.article.title),1)],64))]),a("div",be,[l.article.feed?.id?(i(),o("a",{key:0,href:r.route("articles.index",{feed_id:l.article.feed.id}),class:"flex items-center gap-2 hover:text-blue-500 dark:hover:text-blue-400 transition-colors",onClick:e[2]||(e[2]=le(n=>j(v).get(r.route("articles.index",{feed_id:l.article.feed.id})),["prevent"]))},[l.article.feed?.favicon_url?(i(),o("img",{key:0,src:l.article.feed.favicon_url,class:"h-4 w-4 rounded-sm",alt:""},null,8,we)):c("",!0),a("span",null,m(l.article.feed?.title),1)],8,ye)):c("",!0),l.article.author?(i(),o("span",Ae,"· "+m(l.article.author),1)):c("",!0),a("span",null,"· "+m(W.value)+" at "+m(Y.value),1)])]),F.value?(i(),o("img",{key:0,src:l.article.image_url,alt:l.article.title,class:"mb-6 w-full max-h-80 object-cover rounded-lg",loading:"lazy"},null,8,Se)):c("",!0),a("div",{class:"article-content prose max-w-none dark:prose-invert prose-headings:text-neutral-800 dark:prose-headings:text-neutral-200 prose-p:text-neutral-700 dark:prose-p:text-neutral-300 prose-a:text-blue-400 prose-a:no-underline hover:prose-a:underline prose-strong:text-neutral-800 dark:prose-strong:text-neutral-200 prose-code:text-blue-300 prose-pre:bg-neutral-50 dark:prose-pre:bg-neutral-900 prose-pre:border prose-pre:border-neutral-200 dark:prose-pre:border-neutral-800 prose-img:rounded-lg prose-blockquote:border-neutral-300 dark:prose-blockquote:border-neutral-700 prose-blockquote:text-neutral-500 dark:prose-blockquote:text-neutral-400",innerHTML:l.article.content||l.article.summary},null,8,Le),!l.article.content&&!l.article.summary?(i(),o("div",Me,[e[9]||(e[9]=a("p",{class:"text-neutral-500 dark:text-neutral-400"}," No article content available. ",-1)),l.article.url?(i(),o("button",{key:0,onClick:N,class:"mt-4 rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 transition-colors"}," Read on original site ")):c("",!0)])):c("",!0)],544)])]),_:1})],64))}};export{$e as default};
